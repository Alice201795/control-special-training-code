C51 COMPILER V9.01   TIMER                                                                 11/17/2017 09:53:34 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN timer.OBJ
COMPILER INVOKED BY: D:\Keil_v4\C51\BIN\C51.EXE timer.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2           *****************************************************************************************
   3           *      实 验 名 称:定时器中断的应用
   4           *  实 验 平 台：清翔电子 QX-MCS51开发板
   5           *      创 建 作 者：miki
   6           *  功 能 说 明：使用定时器0的方式1测试定时器定时器1s让数码管自加1来实现秒表
   7           *  github 地 址：
   8           *      创 建 日 期：2017-11-15
   9           *****************************************************************************************
  10           */
  11          /************************************* 包含头文件 ***************************************/
  12          #include <reg52.h>
  13          
  14          /**************************************** 宏定义 *****************************************/
  15          #define uint unsigned int 
  16          #define uchar unsigned char
  17          
  18          //typedef unsigned char uchar;
  19          //typedef unsigned int uint;
  20          
  21          /*************************************** IO口定义 ****************************************/
  22          
  23          sbit LED = P1 ^ 0;
  24          sbit DULA_IO = P2^6;
  25          sbit WELA_IO = P2^7;
  26          
  27          /************************************* 全局变量定义 **************************************/
  28          uchar GlobalCount = 0;
  29          uchar GlobalNum = 0;
  30          
  31          uchar code GlobalDisplayTable[] = 
  32                  {0x3f,0x06,0x5b,0x4f,0x66,
  33                   0x6d,0x7d,0x07,0x7f,0x6f};     /* 段选，选择要显示的数字 */
  34          
  35          /*************************************** 函数声明 ****************************************/
  36          void timerInterruptInit(void);
  37          void digitalTubeDisplay(uchar num);
  38          void delayMs(uint xms);
  39          
  40          /*
  41           *****************************************************************************************
  42           * 函数名称：main
  43           * 函数功能：主函数，整个程序入口
  44           * 输入参数：无
  45           * 输出参数：无
  46           * 其他说明：无
  47           ******************************************************************************************
  48           */
  49          void main(void)
  50          {       
  51   1          timerInterruptInit();       //定时器中断初始化
  52   1          while(1)
  53   1          {
  54   2                      digitalTubeDisplay(GlobalNum);
  55   2          }
C51 COMPILER V9.01   TIMER                                                                 11/17/2017 09:53:34 PAGE 2   

  56   1      }
  57          
  58          /*
  59           *****************************************************************************************
  60           * 函数名称：timerInterruptInit
  61           * 函数功能：定时器和中断初始化
  62           * 输入参数：无
  63           * 输出参数：无
  64           * 其他说明：无
  65           ******************************************************************************************
  66           */
  67          void timerInterruptInit(void)
  68          {
  69   1              TMOD = 0x01; //初始化TMOD,定时器0,方式1
  70   1              TH0 = (65536 - 50000) / 256; //装填计数
  71   1              TL0 = (65536 - 50000) % 256;
  72   1              EA = 1; //开放所有中断
  73   1              ET0 = 1; //开放定时器0中断控制位
  74   1              TR0 = 1; //定时器0开始计时
  75   1      }
  76          
  77          /*
  78           *****************************************************************************************
  79           * 函数名称：digitalTubeDisplay
  80           * 函数功能：数码管显示函数
  81           * 输入参数：num：需要显示的数字
  82           * 输出参数：无
  83           * 其他说明：无
  84           ******************************************************************************************
  85           */
  86          void digitalTubeDisplay(uchar num)
  87          {
  88   1          uchar ge,shi;
  89   1              
  90   1              ge = num % 10;
  91   1              shi = num / 10;
  92   1      
  93   1              /*************** 显示个位 ****************/
  94   1              DULA_IO = 1;
  95   1              P0 = GlobalDisplayTable[ge];
  96   1              DULA_IO = 0;
  97   1      
  98   1              P0 = 0xff;
  99   1      
 100   1              WELA_IO = 1;
 101   1              P0 = 0x7f;
 102   1              WELA_IO = 0;
 103   1      
 104   1              delayMs(5);
 105   1      
 106   1              /*************** 显示十位 ****************/
 107   1              DULA_IO = 1;
 108   1              P0 = GlobalDisplayTable[shi];
 109   1              DULA_IO = 0;
 110   1      
 111   1              P0 = 0xff;
 112   1      
 113   1              WELA_IO = 1;
 114   1              P0 = 0xbf;
 115   1              WELA_IO = 0;
 116   1              delayMs(5);
 117   1      }
C51 COMPILER V9.01   TIMER                                                                 11/17/2017 09:53:34 PAGE 3   

 118          
 119          /*
 120           *****************************************************************************************
 121           * 函数名称：delayMs
 122           * 函数功能：实现毫秒级的延时
 123           * 输入参数：xms：需要延时时间
 124           * 输出参数：无
 125           * 其他说明：无
 126           ******************************************************************************************
 127           */
 128          void delayMs(uint xms)
 129          {
 130   1          uint x,y;
 131   1          for (x=xms;x>0;x--)
 132   1              for (y=114;y>0;y--);
 133   1      }
 134          
 135          /*
 136           *****************************************************************************************
 137           * 函数名称：Timer0InterruptHandler
 138           * 函数功能：定时器0中断服务函数
 139           * 输入参数：无
 140           * 输出参数：无
 141           * 其他说明：无
 142           ******************************************************************************************
 143           */
 144          void Timer0InterruptHandler() interrupt 1
 145          {
 146   1         TH0 = (65536 - 50000) / 256; //触发中断时重新装填计时
 147   1         TL0 = (65536 - 50000) % 256;
 148   1      
 149   1         GlobalCount ++;
 150   1         if (GlobalCount >= 20)
 151   1         {
 152   2             GlobalCount = 0;
 153   2      
 154   2                 GlobalNum ++;
 155   2                 if (GlobalNum >= 60)
 156   2                     GlobalNum = 0;
 157   2         }
 158   1      }
 159          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    167    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
